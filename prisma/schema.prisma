generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model User {
  id                  String      @id @default(uuid())
  firebaseUid         String      @unique
  email               String      @unique
  name                String?
  lastLoginAt         DateTime?
  createdAt           DateTime    @default(now())
  updatedAt           DateTime    @updatedAt
  ageRange            String?
  banned              Boolean     @default(false)
  gender              String?
  hearingStatus       String?
  lsmVariant          String?
  onboardingCompleted Boolean     @default(false)
  currentStreak       Int         @default(0)
  lastContributionAt  DateTime?
  reputationScore     Int         @default(0)
  role                UserRole    @default(VOLUNTEER)
  recordings          Recording[]

  @@map("users")
}

model Glossary {
  id                Int                @id @default(autoincrement())
  slug              String             @unique
  category          String
  videoReferenceUrl String?            @map("video_reference_url")
  priority          Int                @default(1)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  allowed_roles     UserRole[]
  status            GlossaryStatus     @default(DRAFT)
  visibility        GlossaryVisibility @default(PUBLIC)
  word              String             @default("")
  recordings        Recording[]

  @@map("glossary")
}

model Recording {
  id          String          @id @default(uuid())
  s3Key       String
  filename    String
  contentType String
  duration    Float?
  status      RecordingStatus @default(PENDING)
  userId      String
  glossaryId  Int
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  metadata    Json?
  glossary    Glossary        @relation(fields: [glossaryId], references: [id], onDelete: Cascade)
  user        User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([glossaryId])
  @@index([status])
  @@map("recordings")
}

enum RecordingStatus {
  PENDING
  APPROVED
  REJECTED
  PROCESSING
  UPLOADING
}

enum UserRole {
  ADMIN
  VOLUNTEER
}

enum GlossaryStatus {
  DRAFT
  ACTIVE
  ARCHIVED
}

enum GlossaryVisibility {
  PUBLIC
  RESTRICTED
}
